<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Google Analytics GA4 -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-XXXXXXXXXX');

  // ì»¤ìŠ¤í…€ ì´ë²¤íŠ¸ íŠ¸ë˜í‚¹ í•¨ìˆ˜
  function trackEvent(action, category, label) {
    if (typeof gtag !== 'undefined') {
      gtag('event', action, { event_category: category, event_label: label });
    }
  }
</script>
<title>ğŸŒŒ ë³„ìë¦¬ ìš´ëª…ì˜ ê·¸ë¬¼ â€” GraphRAG ì‹¬ì¸µ ìš´ì„¸</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@300;400;700&family=Cinzel+Decorative:wght@400;700&family=Noto+Sans+KR:wght@300;400&display=swap" rel="stylesheet">
<script>
// vis-network ë¡œë“œ (CDN í´ë°± í¬í•¨)
(function() {
  var s = document.createElement('script');
  s.src = 'https://unpkg.com/vis-network@9.1.9/dist/vis-network.min.js';
  s.onerror = function() {
    var s2 = document.createElement('script');
    s2.src = 'https://cdn.jsdelivr.net/npm/vis-network@9.1.9/dist/vis-network.min.js';
    document.head.appendChild(s2);
  };
  document.head.appendChild(s);
})();
</script>
<!-- vis-network ìŠ¤íƒ€ì¼ ì¸ë¼ì¸ ì²˜ë¦¬ -->
<style>
  :root {
    --void: #03010a;
    --deep: #08021a;
    --cosmos: #0d0528;
    --nebula: #1a0a45;
    --violet: #6b21a8;
    --aurora: #9333ea;
    --star: #e9d5ff;
    --gold: #fbbf24;
    --silver: #c4b5fd;
    --glow: rgba(147,51,234,0.4);
    --sun-color: #fbbf24;
    --moon-color: #93c5fd;
    --rising-color: #6ee7b7;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--void);
    color: var(--star);
    font-family: 'Noto Sans KR', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* ìš°ì£¼ ë°°ê²½ íŒŒí‹°í´ */
  #starfield {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    pointer-events: none;
    z-index: 0;
  }

  .wrapper {
    position: relative;
    z-index: 1;
    max-width: 900px;
    margin: 0 auto;
    padding: 40px 20px;
  }

  /* í—¤ë” */
  header {
    text-align: center;
    margin-bottom: 50px;
  }

  header .subtitle {
    font-family: 'Cinzel Decorative', serif;
    font-size: 0.85rem;
    letter-spacing: 0.3em;
    color: var(--aurora);
    text-transform: uppercase;
    margin-bottom: 16px;
    opacity: 0.8;
  }

  header h1 {
    font-family: 'Cinzel Decorative', serif;
    font-size: clamp(1.8rem, 5vw, 2.8rem);
    font-weight: 700;
    background: linear-gradient(135deg, var(--gold) 0%, var(--silver) 50%, var(--aurora) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    line-height: 1.4;
    margin-bottom: 12px;
  }

  header p.desc {
    font-size: 1rem;
    color: rgba(196,181,253,0.85);
    font-weight: 300;
    line-height: 1.7;
  }

  /* ì„¤ëª… ë°°ë„ˆ */
  .graphrag-badge {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    background: linear-gradient(135deg, rgba(107,33,168,0.3), rgba(147,51,234,0.2));
    border: 1px solid rgba(147,51,234,0.4);
    border-radius: 20px;
    padding: 6px 16px;
    font-size: 0.82rem;
    color: var(--silver);
    margin-top: 16px;
    letter-spacing: 0.05em;
  }

  /* ì…ë ¥ ì„¹ì…˜ */
  .input-section {
    background: linear-gradient(135deg, rgba(13,5,40,0.9), rgba(26,10,69,0.6));
    border: 1px solid rgba(107,33,168,0.4);
    border-radius: 20px;
    padding: 32px;
    margin-bottom: 30px;
    backdrop-filter: blur(10px);
  }

  /* â”€â”€ ì…ë ¥ ëª¨ë“œ íƒ­ â”€â”€ */
  .mode-tabs {
    display: flex;
    gap: 8px;
    margin-bottom: 22px;
  }
  .mode-tab {
    flex: 1;
    padding: 11px 8px;
    background: rgba(107,33,168,0.1);
    border: 1px solid rgba(107,33,168,0.25);
    border-radius: 12px;
    color: rgba(196,181,253,0.6);
    font-size: 0.9rem;
    font-family: 'Noto Sans KR', sans-serif;
    cursor: pointer;
    transition: all 0.25s;
    text-align: center;
  }
  .mode-tab.active {
    background: linear-gradient(135deg, rgba(107,33,168,0.4), rgba(147,51,234,0.25));
    border-color: var(--aurora);
    color: #fff;
    font-weight: 700;
    box-shadow: 0 0 16px rgba(147,51,234,0.2);
  }
  .mode-tab:hover:not(.active) {
    border-color: rgba(147,51,234,0.4);
    color: var(--silver);
  }

  /* â”€â”€ ìƒë…„ì›”ì¼ ì…ë ¥ í¼ â”€â”€ */
  .birth-form {
    display: none;
    flex-direction: column;
    gap: 18px;
    margin-bottom: 22px;
    animation: fadeIn 0.3s ease;
  }
  .birth-form.active { display: flex; }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(-8px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  .birth-row {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 10px;
  }
  .birth-row.two-col { grid-template-columns: 1fr 1fr; }

  .birth-field {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }
  .birth-field label {
    font-size: 0.8rem;
    letter-spacing: 0.15em;
    color: var(--aurora);
    text-transform: uppercase;
  }
  .birth-field input,
  .birth-field select {
    background: rgba(0,0,0,0.35);
    border: 1px solid rgba(107,33,168,0.35);
    border-radius: 10px;
    color: #fff;
    font-size: 1rem;
    font-family: 'Noto Sans KR', sans-serif;
    padding: 11px 12px;
    width: 100%;
    transition: border-color 0.2s;
    -webkit-appearance: none;
    appearance: none;
  }
  .birth-field input:focus,
  .birth-field select:focus {
    outline: none;
    border-color: var(--aurora);
    box-shadow: 0 0 12px rgba(147,51,234,0.2);
  }
  .birth-field select option { background: #1a0a45; color: #fff; }

  .birth-time-toggle {
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
    font-size: 0.9rem;
    color: rgba(196,181,253,0.7);
    user-select: none;
  }
  .birth-time-toggle input[type=checkbox] { display: none; }
  .toggle-switch {
    width: 38px; height: 20px;
    background: rgba(107,33,168,0.3);
    border: 1px solid rgba(147,51,234,0.4);
    border-radius: 20px;
    position: relative;
    transition: background 0.25s;
    flex-shrink: 0;
  }
  .toggle-switch::after {
    content: '';
    position: absolute;
    top: 2px; left: 2px;
    width: 14px; height: 14px;
    background: var(--silver);
    border-radius: 50%;
    transition: transform 0.25s;
  }
  .birth-time-toggle input:checked + .toggle-switch {
    background: var(--violet);
    border-color: var(--aurora);
  }
  .birth-time-toggle input:checked + .toggle-switch::after {
    transform: translateX(18px);
  }

  .birth-time-fields {
    display: none;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
  }
  .birth-time-fields.visible { display: grid; }

  /* ê³„ì‚° ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸° */
  .chart-preview {
    display: none;
    background: linear-gradient(135deg, rgba(107,33,168,0.15), rgba(147,51,234,0.08));
    border: 1px solid rgba(147,51,234,0.3);
    border-radius: 12px;
    padding: 14px 16px;
    gap: 8px;
    flex-direction: column;
  }
  .chart-preview.visible { display: flex; }
  .chart-preview-title {
    font-size: 0.75rem;
    letter-spacing: 0.2em;
    color: var(--aurora);
    text-transform: uppercase;
    margin-bottom: 4px;
  }
  .chart-preview-signs {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }
  .preview-badge {
    display: flex;
    align-items: center;
    gap: 6px;
    background: rgba(147,51,234,0.2);
    border: 1px solid rgba(196,181,253,0.25);
    border-radius: 20px;
    padding: 5px 12px;
    font-size: 0.9rem;
    color: var(--star);
  }
  .preview-badge .pb-icon { font-size: 1rem; }
  .preview-badge .pb-label { font-size: 0.72rem; color: var(--silver); }

  .section-label {
    font-size: 0.72rem;
    letter-spacing: 0.3em;
    color: var(--aurora);
    text-transform: uppercase;
    margin-bottom: 24px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .section-label::after {
    content: '';
    flex: 1;
    height: 1px;
    background: linear-gradient(90deg, rgba(147,51,234,0.5), transparent);
  }

  /* 3ê°œ ë³„ìë¦¬ ê·¸ë¦¬ë“œ */
  .signs-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 16px;
    margin-bottom: 24px;
    overflow: visible;
    position: relative;
    z-index: 1;
  }

  .sign-card {
    background: rgba(0,0,0,0.3);
    border-radius: 14px;
    padding: 16px;
    border: 1px solid rgba(107,33,168,0.25);
    transition: all 0.3s ease;
  }

  .sign-card:hover {
    border-color: rgba(147,51,234,0.5);
    transform: translateY(-2px);
  }

  .sign-card .card-label {
    font-size: 0.9rem;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 6px;
    font-weight: 400;
    letter-spacing: 0.05em;
  }

  .sign-card.sun .card-label { color: var(--sun-color); }
  .sign-card.moon .card-label { color: var(--moon-color); }
  .sign-card.rising .card-label { color: var(--rising-color); }

  .sign-card .card-dot {
    width: 8px; height: 8px;
    border-radius: 50%;
    display: inline-block;
  }
  .sign-card.sun .card-dot { background: var(--sun-color); box-shadow: 0 0 6px var(--sun-color); }
  .sign-card.moon .card-dot { background: var(--moon-color); box-shadow: 0 0 6px var(--moon-color); }
  .sign-card.rising .card-dot { background: var(--rising-color); box-shadow: 0 0 6px var(--rising-color); }

  .sign-card select {
    width: 100%;
    background: rgba(0,0,0,0.4);
    border: 1px solid rgba(107,33,168,0.3);
    color: var(--star);
    padding: 10px 12px;
    border-radius: 8px;
    font-size: 0.85rem;
    font-family: 'Noto Sans KR', sans-serif;
    cursor: pointer;
    outline: none;
    appearance: none;
    -webkit-appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath fill='%239333ea' d='M6 8L0 0h12z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 10px center;
  }

  .sign-card select:focus {
    border-color: var(--aurora);
  }

  .sign-card select option {
    background: var(--deep);
    color: var(--star);
  }

  /* ê³ ë¯¼ ì…ë ¥ */
  .concern-box {
    margin-bottom: 8px;
  }

  .concern-box label {
    display: block;
    font-size: 0.95rem;
    color: var(--silver);
    margin-bottom: 10px;
    letter-spacing: 0.1em;
  }

  .concern-box textarea {
    width: 100%;
    background: rgba(0,0,0,0.3);
    border: 1px solid rgba(107,33,168,0.3);
    color: var(--star);
    padding: 12px 16px;
    border-radius: 10px;
    font-size: 1rem;
    font-family: 'Noto Sans KR', sans-serif;
    resize: none;
    outline: none;
    line-height: 1.6;
    transition: border-color 0.3s;
  }

  .concern-box textarea:focus {
    border-color: var(--aurora);
  }

  .concern-box textarea::placeholder {
    color: rgba(196,181,253,0.35);
  }

  /* ë²„íŠ¼ */
  .btn-analyze {
    width: 100%;
    padding: 16px;
    background: linear-gradient(135deg, var(--violet), var(--aurora));
    border: none;
    border-radius: 12px;
    color: white;
    font-size: 1.15rem;
    font-family: 'Noto Serif KR', serif;
    font-weight: 700;
    cursor: pointer;
    letter-spacing: 0.1em;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
    margin-top: 20px;
  }

  .btn-analyze::before {
    content: '';
    position: absolute;
    top: 0; left: -100%;
    width: 100%; height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent);
    transition: left 0.5s ease;
  }

  .btn-analyze:hover::before { left: 100%; }
  .btn-analyze:hover { transform: translateY(-2px); box-shadow: 0 8px 30px rgba(147,51,234,0.5); }
  .btn-analyze:active { transform: translateY(0); }
  .btn-analyze:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

  /* ë¡œë”© */
  .loading-state {
    display: none;
    text-align: center;
    padding: 50px 20px;
  }

  .loading-state.active { display: block; }

  .orbit-loader {
    width: 60px; height: 60px;
    margin: 0 auto 20px;
    position: relative;
  }

  .orbit-loader .planet {
    width: 12px; height: 12px;
    background: var(--aurora);
    border-radius: 50%;
    position: absolute;
    top: 50%; left: 50%;
    transform-origin: -18px 0;
    animation: orbit 1.8s linear infinite;
    box-shadow: 0 0 10px var(--aurora);
  }

  .orbit-loader .planet:nth-child(2) {
    background: var(--gold);
    transform-origin: -28px 0;
    animation-duration: 2.4s;
    animation-delay: -0.6s;
    width: 8px; height: 8px;
  }

  .orbit-loader .planet:nth-child(3) {
    background: var(--moon-color);
    transform-origin: -12px 0;
    animation-duration: 1.2s;
    animation-delay: -1.2s;
    width: 6px; height: 6px;
  }

  @keyframes orbit {
    from { transform: translate(-50%, -50%) rotate(0deg) translateX(28px); }
    to { transform: translate(-50%, -50%) rotate(360deg) translateX(28px); }
  }

  .loading-steps {
    font-size: 0.95rem;
    color: var(--silver);
    line-height: 2;
  }

  .loading-step {
    opacity: 0;
    transition: opacity 0.5s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }

  .loading-step.active { opacity: 1; }
  .loading-step .dot { width: 6px; height: 6px; border-radius: 50%; background: var(--aurora); }

  /* ê²°ê³¼ ì˜ì—­ */
  .result-section {
    display: none;
  }

  .result-section.active { display: block; }

  /* ê·¸ë˜í”„ ì‹œê°í™” */
  .graph-container {
    background: linear-gradient(135deg, rgba(13,5,40,0.95), rgba(8,2,26,0.95));
    border: 1px solid rgba(107,33,168,0.4);
    border-radius: 16px;
    margin-bottom: 24px;
    overflow: hidden;
  }

  .graph-header {
    padding: 16px 20px;
    border-bottom: 1px solid rgba(107,33,168,0.2);
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .graph-header h3 {
    font-size: 0.95rem;
    letter-spacing: 0.2em;
    color: var(--silver);
    text-transform: uppercase;
    font-weight: 400;
  }

  .pulse-dot {
    width: 8px; height: 8px;
    border-radius: 50%;
    background: var(--aurora);
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0%, 100% { box-shadow: 0 0 0 0 rgba(147,51,234,0.7); }
    50% { box-shadow: 0 0 0 6px rgba(147,51,234,0); }
  }

  #graph-canvas {
    height: 280px;
    width: 100%;
  }

  /* ë¶„ì„ ê²°ê³¼ ì¹´ë“œ */
  .analysis-cards {
    display: grid;
    grid-template-columns: 1fr;
    gap: 16px;
    margin-bottom: 24px;
  }

  .analysis-card {
    background: linear-gradient(135deg, rgba(13,5,40,0.9), rgba(26,10,69,0.5));
    border: 1px solid rgba(107,33,168,0.3);
    border-radius: 16px;
    padding: 24px;
    animation: fadeSlideIn 0.6s ease forwards;
    opacity: 0;
  }

  @keyframes fadeSlideIn {
    from { opacity: 0; transform: translateY(16px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .analysis-card:nth-child(1) { animation-delay: 0.1s; }
  .analysis-card:nth-child(2) { animation-delay: 0.25s; }
  .analysis-card:nth-child(3) { animation-delay: 0.4s; }

  .card-title {
    font-size: 0.72rem;
    letter-spacing: 0.3em;
    text-transform: uppercase;
    margin-bottom: 14px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .card-title .icon { font-size: 1rem; }

  .card-title.path { color: var(--gold); }
  .card-title.deep { color: var(--aurora); }
  .card-title.action { color: var(--rising-color); }

  .card-body {
    font-family: 'Noto Serif KR', serif;
    font-size: 1.05rem;
    line-height: 2.0;
    color: rgba(233,213,255,0.9);
    font-weight: 300;
  }

  /* ê´€ê³„ ê²½ë¡œ íƒœê·¸ */
  .path-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 14px;
  }

  .path-tag {
    background: rgba(107,33,168,0.25);
    border: 1px solid rgba(147,51,234,0.35);
    border-radius: 20px;
    padding: 4px 12px;
    font-size: 0.72rem;
    color: var(--silver);
    display: flex;
    align-items: center;
    gap: 4px;
  }

  .path-tag .connector {
    color: var(--aurora);
    font-size: 0.65rem;
  }

  /* ê³µìœ  ë²„íŠ¼ ì„¹ì…˜ */
  .share-section {
    background: linear-gradient(135deg, rgba(254,215,170,0.08), rgba(107,33,168,0.12));
    border: 1px solid rgba(254,215,170,0.2);
    border-radius: 16px;
    padding: 24px;
    text-align: center;
    margin-bottom: 16px;
  }

  .share-title {
    font-size: 1rem;
    color: rgba(233,213,255,0.85);
    margin-bottom: 16px;
    line-height: 1.7;
    font-family: 'Noto Serif KR', serif;
  }

  .share-buttons {
    display: flex;
    gap: 12px;
    justify-content: center;
    flex-wrap: wrap;
  }

  .btn-kakao {
    display: inline-flex;
    align-items: center;
    padding: 13px 28px;
    background: #FEE500;
    border: none;
    border-radius: 12px;
    color: #3C1E1E;
    font-size: 1rem;
    font-family: 'Noto Sans KR', sans-serif;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.25s ease;
    box-shadow: 0 4px 14px rgba(254,229,0,0.25);
  }

  .btn-kakao:hover {
    background: #FFD700;
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(254,229,0,0.4);
  }

  .btn-kakao:active { transform: translateY(0); }

  .btn-copy-link {
    display: inline-flex;
    align-items: center;
    padding: 13px 28px;
    background: rgba(147,51,234,0.2);
    border: 1px solid rgba(147,51,234,0.4);
    border-radius: 12px;
    color: var(--silver);
    font-size: 1rem;
    font-family: 'Noto Sans KR', sans-serif;
    cursor: pointer;
    transition: all 0.25s ease;
  }

  .btn-copy-link:hover {
    background: rgba(147,51,234,0.35);
    border-color: var(--aurora);
    transform: translateY(-2px);
  }

  /* ì¬ì‹œë„ ë²„íŠ¼ */
  .btn-reset {
    width: 100%;
    padding: 12px;
    background: transparent;
    border: 1px solid rgba(107,33,168,0.4);
    border-radius: 10px;
    color: var(--silver);
    font-size: 0.95rem;
    cursor: pointer;
    letter-spacing: 0.1em;
    margin-top: 16px;
    transition: all 0.3s;
  }

  .btn-reset:hover {
    border-color: var(--aurora);
    color: var(--aurora);
    background: rgba(107,33,168,0.1);
  }

  /* ì—ëŸ¬ */
  .error-msg {
    display: none;
    background: rgba(239,68,68,0.1);
    border: 1px solid rgba(239,68,68,0.3);
    border-radius: 10px;
    padding: 14px;
    color: #fca5a5;
    font-size: 0.95rem;
    text-align: center;
    margin-top: 12px;
  }
  .error-msg.active { display: block; }

  /* ===== ì•ˆë‚´ ë°°ë„ˆ ===== */
  .guide-banner {
    background: rgba(147,51,234,0.08);
    border: 1px solid rgba(147,51,234,0.2);
    border-radius: 12px;
    padding: 14px 18px;
    margin-bottom: 22px;
    font-size: 0.95rem;
    color: rgba(196,181,253,0.8);
    line-height: 1.7;
    cursor: pointer;
    transition: all 0.3s;
  }
  .guide-banner:hover { border-color: rgba(147,51,234,0.4); }
  .guide-banner .guide-title {
    display: flex; align-items: center; gap: 8px;
    color: var(--silver); font-size: 0.95rem; margin-bottom: 4px;
  }
  .guide-banner .guide-arrow { transition: transform 0.3s; display: inline-block; }
  .guide-banner.open .guide-arrow { transform: rotate(180deg); }
  .guide-content { display: none; margin-top: 10px; }
  .guide-banner.open .guide-content { display: block; }
  .guide-row {
    display: flex; gap: 8px; align-items: flex-start;
    padding: 6px 0; border-bottom: 1px solid rgba(107,33,168,0.15);
    font-size: 0.9rem;
  }
  .guide-row:last-child { border-bottom: none; }
  .guide-row .gr-icon { font-size: 1rem; flex-shrink: 0; width: 22px; }
  .guide-row .gr-label { color: var(--silver); font-weight: 400; min-width: 55px; flex-shrink: 0; }
  .guide-row .gr-desc { color: rgba(196,181,253,0.7); }

  /* ===== ì»¤ìŠ¤í…€ ë“œë¡­ë‹¤ìš´ ===== */
  .custom-select-wrap {
    position: relative;
  }

  .custom-trigger {
    width: 100%;
    background: rgba(0,0,0,0.4);
    border: 1px solid rgba(107,33,168,0.3);
    color: var(--star);
    padding: 10px 36px 10px 12px;
    border-radius: 10px;
    font-size: 1rem;
    font-family: 'Noto Sans KR', sans-serif;
    cursor: pointer;
    transition: all 0.25s;
    text-align: left;
    display: flex;
    align-items: center;
    gap: 6px;
    min-height: 42px;
    position: relative;
    user-select: none;
  }

  .custom-trigger::after {
    content: 'â–¾';
    position: absolute;
    right: 12px; top: 50%;
    transform: translateY(-50%);
    color: var(--aurora);
    font-size: 0.75rem;
    transition: transform 0.25s;
  }

  .custom-trigger.open::after { transform: translateY(-50%) rotate(180deg); }

  .custom-trigger:hover, .custom-trigger.open {
    border-color: var(--aurora);
    background: rgba(107,33,168,0.12);
  }

  .custom-trigger .placeholder { color: rgba(196,181,253,0.4); }
  .custom-trigger .selected-symbol { font-size: 1rem; }
  .custom-trigger .selected-name { font-weight: 400; flex: 1; }
  .custom-trigger .selected-hint {
    font-size: 0.68rem;
    color: rgba(196,181,253,0.55);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 80px;
  }

  /* ë“œë¡­ë‹¤ìš´ íŒ¨ë„ */
  /* ë“œë¡­ë‹¤ìš´ í¬í„¸ - bodyì— ì§ì ‘ ë¶™ìŒ */
  .dropdown-portal {
    display: none;
    position: fixed;
    background: #110535;
    border: 2px solid rgba(147,51,234,0.75);
    border-radius: 14px;
    z-index: 99999;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0,0,0,0.99), 0 0 0 2px rgba(147,51,234,0.2);
    animation: dropDown 0.18s ease;
  }
  .dropdown-portal.open { display: block; }

  @keyframes dropDown {
    from { opacity: 0; transform: translateY(-6px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .custom-dropdown.open { display: block; }

  .custom-dropdown::-webkit-scrollbar { width: 4px; }
  .custom-dropdown::-webkit-scrollbar-track { background: transparent; }
  .custom-dropdown::-webkit-scrollbar-thumb { background: rgba(147,51,234,0.4); border-radius: 2px; }

  .dropdown-item {
    padding: 14px 16px;
    cursor: pointer;
    border-bottom: 1px solid rgba(147,51,234,0.2);
    transition: background 0.15s;
    display: grid;
    grid-template-columns: 34px 1fr auto;
    grid-template-rows: auto auto;
    gap: 2px 10px;
    align-items: start;
  }

  .dropdown-item:last-child { border-bottom: none; }
  .dropdown-item:hover { background: rgba(107,33,168,0.45); }   /* ë” ì§„í•œ í˜¸ë²„ */
  .dropdown-item.selected { background: rgba(147,51,234,0.4); }

  .dropdown-item .di-symbol {
    grid-row: 1 / 3; grid-column: 1;
    font-size: 1.3rem;
    display: flex; align-items: flex-start; justify-content: center;
    padding-top: 2px;
  }

  .dropdown-item .di-name {
    grid-row: 1; grid-column: 2;
    font-size: 1.1rem;
    color: #FFFFFF;
    font-weight: 700;
    white-space: nowrap;   /* ì¤„ë°”ê¿ˆ ë°©ì§€ */
  }

  .dropdown-item .di-badge {
    grid-row: 1; grid-column: 3;
    font-size: 0.95rem;
    background: rgba(107,33,168,0.3);
    border: 1px solid rgba(147,51,234,0.25);
    border-radius: 10px;
    padding: 2px 7px;
    color: var(--silver);
    white-space: nowrap;
  }

  .dropdown-item .di-desc {
    grid-row: 2; grid-column: 2 / 4;
    font-size: 1rem;
    color: rgba(220,210,255,0.9);  /* ë°ê²Œ */
    margin-top: 4px;
    line-height: 1.5;
  }

  /* ì„ íƒ í›„ ìƒì„¸ ì¹´ë“œ */
  .sign-info-card {
    display: none;
    margin-top: 10px;
    background: rgba(0,0,0,0.25);
    border-radius: 10px;
    padding: 10px 12px;
    border-left: 3px solid;
    animation: fadeSlideIn 0.3s ease;
  }
  .sign-info-card.visible { display: block; }
  .sign-card.sun .sign-info-card { border-left-color: var(--sun-color); }
  .sign-card.moon .sign-info-card { border-left-color: var(--moon-color); }
  .sign-card.rising .sign-info-card { border-left-color: var(--rising-color); }

  .sign-info-card .sic-row {
    display: flex; gap: 6px; align-items: baseline;
    font-size: 0.88rem; margin-bottom: 6px;
    line-height: 1.5;
  }
  .sign-info-card .sic-row:last-child { margin-bottom: 0; }
  .sign-info-card .sic-label { color: rgba(196,181,253,0.6); min-width: 42px; flex-shrink: 0; }
  .sign-info-card .sic-val { color: rgba(233,213,255,0.85); }
  .sign-info-card .sic-keywords {
    display: flex; flex-wrap: wrap; gap: 4px; margin-top: 6px;
  }
  .sign-info-card .kw {
    font-size: 0.8rem;
    background: rgba(107,33,168,0.2);
    border: 1px solid rgba(147,51,234,0.2);
    border-radius: 8px;
    padding: 2px 8px;
    color: var(--silver);
  }

  /* ë°˜ì‘í˜• */
  @media (max-width: 768px) {
    /* ì „ì²´ ê¸°ë³¸ í¬ê¸° í™•ëŒ€ */
    body { font-size: 17px; }
    .signs-grid { grid-template-columns: 1fr; gap: 18px; }
    .input-section { padding: 24px 18px; }
    .wrapper { padding: 30px 16px; }
    .custom-dropdown { max-height: 55vh; }

    /* í—¤ë” */
    header h1 { font-size: clamp(2rem, 8vw, 2.8rem); }
    header p.desc { font-size: 1.1rem; line-height: 1.8; }
    .graphrag-badge { font-size: 0.9rem; padding: 8px 18px; }
    .subtitle { font-size: 0.9rem; }

    /* ì„¹ì…˜ ë¼ë²¨ */
    .section-label { font-size: 1rem; }

    /* ì¹´ë“œ ë¼ë²¨ */
    .card-label { font-size: 1rem; margin-bottom: 12px; }

    /* ë“œë¡­ë‹¤ìš´ íŠ¸ë¦¬ê±° */
    .custom-trigger { font-size: 1.1rem; padding: 13px 40px 13px 14px; min-height: 50px; }

    /* ë“œë¡­ë‹¤ìš´ í•­ëª© */
    .dropdown-item { padding: 16px 14px; }
    .dropdown-item .di-symbol { font-size: 1.3rem; }
    .dropdown-item .di-name { font-size: 1.15rem; }
    .dropdown-item .di-desc { font-size: 0.95rem; line-height: 1.5; }
    .dropdown-item .di-badge { font-size: 0.85rem; padding: 3px 9px; }

    /* ì„ íƒ í›„ ì •ë³´ ì¹´ë“œ */
    .sign-card { padding: 20px; }
    .sign-info-card { padding: 14px 16px; }
    .sign-info-card .sic-row { font-size: 1rem; margin-bottom: 7px; }
    .sign-info-card .kw { font-size: 0.9rem; padding: 4px 10px; }

    /* ê³ ë¯¼ ì…ë ¥ */
    .concern-box label { font-size: 1.05rem; }
    .concern-box textarea { font-size: 1.05rem; padding: 14px 16px; }

    /* ë²„íŠ¼ */
    .btn-analyze { font-size: 1.2rem; padding: 20px; border-radius: 14px; }
    .btn-reset { font-size: 1rem; padding: 15px; }

    /* ì—ëŸ¬ */
    .error-msg { font-size: 1rem; padding: 16px; }

    /* ì•ˆë‚´ ë°°ë„ˆ */
    .guide-banner { font-size: 1rem; padding: 16px 18px; }
    .guide-row { font-size: 0.95rem; padding: 8px 0; }
    .guide-banner .guide-title { font-size: 1rem; }

    /* ê²°ê³¼ ì¹´ë“œ */
    .card-title { font-size: 0.95rem; }
    .card-body { font-size: 1.1rem; line-height: 2.1; }
    .analysis-card { padding: 22px; }

    /* ê·¸ë˜í”„ */
    .graph-header h3 { font-size: 0.95rem; }
    #graph-canvas { height: 220px; }

    /* ê²½ë¡œ íƒœê·¸ */
    .path-tag { font-size: 0.88rem; padding: 6px 14px; }

    /* ê³µìœ  ë²„íŠ¼ */
    .btn-kakao { font-size: 1.1rem; padding: 16px 28px; }
    .btn-copy-link { font-size: 1.1rem; padding: 16px 24px; }
    .share-title { font-size: 1.05rem; }

    /* ë¡œë”© */
    .loading-steps { font-size: 0.95rem; }

    /* ê·¸ë˜í”„ í—¤ë” */
    .graph-header { padding: 14px 18px; }

    /* ë“œë¡­ë‹¤ìš´ ëª¨ë°”ì¼ */
    .dropdown-item .di-name  { font-size: 1.25rem !important; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .dropdown-item .di-desc  { font-size: 0.92rem !important; line-height: 1.5; white-space: normal; }
    .dropdown-item .di-badge { font-size: 0.8rem !important; padding: 3px 9px !important; white-space: nowrap; }
    .dropdown-item .di-symbol { font-size: 1.4rem !important; }
    .dropdown-item { padding: 16px 14px !important; gap: 2px 8px !important; }
    .dropdown-portal { border-radius: 16px !important; }

    /* íŠ¸ë¦¬ê±° ë²„íŠ¼ ë” í¬ê²Œ */
    .custom-trigger { min-height: 58px !important; font-size: 1.2rem !important; }

    /* ì„ íƒ í›„ ì •ë³´ ì¹´ë“œ ê¸€ì */
    .sic-val { font-size: 1.05rem !important; }
    .sic-label { font-size: 0.95rem !important; }
    .kw { font-size: 0.95rem !important; padding: 5px 12px !important; }

    /* ì¹´ë“œ ë¼ë²¨ */
    .card-label { font-size: 1.1rem !important; }

    /* ìƒë…„ì›”ì¼ í¼ ëª¨ë°”ì¼ */
    .birth-row { grid-template-columns: 1fr 1fr; }
    .birth-row.two-col { grid-template-columns: 1fr 1fr; }
    .birth-field input, .birth-field select { font-size: 1.05rem !important; padding: 13px 12px !important; }
    .birth-field label { font-size: 0.85rem !important; }
    .birth-time-toggle { font-size: 1rem !important; }
    .mode-tab { font-size: 0.88rem !important; padding: 13px 6px !important; }
    .preview-badge { font-size: 0.95rem !important; }

    /* path-tag â€” ì´ì „ ê·œì¹™ ë®ì–´ì“°ê¸° */
    .path-tag { font-size: 0.8rem; }
    .guide-banner { font-size: 1rem; }
  }
</style>
</head>
<body>

<canvas id="starfield"></canvas>

<div class="wrapper">
  <!-- í—¤ë” -->
  <header>
    <div class="subtitle">GraphRAG Powered</div>
    <h1>ë³„ìë¦¬ ìš´ëª…ì˜ ê·¸ë¬¼</h1>
    <p class="desc">íƒœì–‘ê¶ Â· ë‹¬ê¶ Â· ìƒìŠ¹ê¶ì˜ ì„¸ ì—ë„ˆì§€ê°€ êµì°¨í•˜ëŠ” ì§€ì <br>ì§€ì‹ ê·¸ë˜í”„ê°€ ì¶”ì í•˜ëŠ” ë‹¹ì‹ ë§Œì˜ ìš´ëª… ê²½ë¡œ</p>
    <div class="graphrag-badge">
      <span>â¬¡</span>
      <span>ì„¸ ë³„ìë¦¬ ê´€ê³„ë§ ë¶„ì„ Â· ê·¼ê±° ê²½ë¡œ ì‹œê°í™” Â· ì‹¬ì¸µ í•´ì„</span>
    </div>
  </header>

  <!-- ì…ë ¥ ì„¹ì…˜ -->
  <div class="input-section" id="inputSection">
    <div class="section-label">ë‚˜ì˜ ì„¸ ë³„ìë¦¬ ì…ë ¥</div>

    <!-- ì…ë ¥ ëª¨ë“œ íƒ­ -->
    <div class="mode-tabs">
      <button class="mode-tab active" id="tabManual" onclick="switchMode('manual')">
        â˜€ï¸ ë³„ìë¦¬ ì§ì ‘ ì„ íƒ
      </button>
      <button class="mode-tab" id="tabBirth" onclick="switchMode('birth')">
        ğŸ‚ ìƒë…„ì›”ì¼ë¡œ ìë™ ê³„ì‚°
      </button>
    </div>

    <!-- ìƒë…„ì›”ì¼ ì…ë ¥ í¼ (ê¸°ë³¸ ìˆ¨ê¹€) -->
    <div class="birth-form" id="birthForm">

      <!-- ìƒë…„ì›”ì¼ -->
      <div class="birth-row">
        <div class="birth-field">
          <label>ğŸ“… ë…„ë„</label>
          <input type="number" id="birthYear" placeholder="ì˜ˆ: 1990"
            min="1900" max="2025" inputmode="numeric"
            oninput="onBirthChange()">
        </div>
        <div class="birth-field">
          <label>ì›”</label>
          <select id="birthMonth" onchange="onBirthChange()">
            <option value="">ì›” ì„ íƒ</option>
            <option value="1">1ì›”</option><option value="2">2ì›”</option>
            <option value="3">3ì›”</option><option value="4">4ì›”</option>
            <option value="5">5ì›”</option><option value="6">6ì›”</option>
            <option value="7">7ì›”</option><option value="8">8ì›”</option>
            <option value="9">9ì›”</option><option value="10">10ì›”</option>
            <option value="11">11ì›”</option><option value="12">12ì›”</option>
          </select>
        </div>
        <div class="birth-field">
          <label>ì¼</label>
          <input type="number" id="birthDay" placeholder="ì¼"
            min="1" max="31" inputmode="numeric"
            oninput="onBirthChange()">
        </div>
      </div>

      <!-- ì¶œìƒ ì‹œê°„ í† ê¸€ -->
      <label class="birth-time-toggle">
        <input type="checkbox" id="timeKnown" onchange="toggleTimeFields()">
        <span class="toggle-switch"></span>
        â° ì¶œìƒ ì‹œê°„ì„ ì•Œê³  ìˆì–´ìš” (ìƒìŠ¹ê¶ ìë™ ê³„ì‚°)
      </label>

      <!-- ì‹œê°„ í•„ë“œ (ìˆ¨ê¹€/í‘œì‹œ) -->
      <div class="birth-time-fields" id="timeFields">
        <div class="birth-field">
          <label>ì‹œê°„ (0~23)</label>
          <input type="number" id="birthHour" placeholder="14"
            min="0" max="23" inputmode="numeric"
            oninput="onBirthChange()">
        </div>
        <div class="birth-field">
          <label>ë¶„ (0~59)</label>
          <input type="number" id="birthMinute" placeholder="30"
            min="0" max="59" inputmode="numeric"
            oninput="onBirthChange()">
        </div>
      </div>

      <!-- ì¶œìƒì§€ (ì„ íƒ) -->
      <div class="birth-field">
        <label>ğŸŒ ì¶œìƒ ë„ì‹œ (ìƒìŠ¹ê¶ ì •ë°€ ê³„ì‚°ìš©, ì„ íƒ)</label>
        <select id="birthCity" onchange="onBirthChange()">
          <option value="37.5665,126.978">ì„œìš¸ / ëŒ€í•œë¯¼êµ­</option>
          <option value="35.1796,129.0756">ë¶€ì‚°</option>
          <option value="35.8714,128.6014">ëŒ€êµ¬</option>
          <option value="37.4563,126.7052">ì¸ì²œ</option>
          <option value="35.1595,126.8526">ê´‘ì£¼</option>
          <option value="36.3504,127.3845">ëŒ€ì „</option>
          <option value="35.5384,129.3114">ìš¸ì‚°</option>
          <option value="37.2750,127.0094">ìˆ˜ì›</option>
          <option value="35.6895,139.6917">ë„ì¿„ / ì¼ë³¸</option>
          <option value="39.9042,116.4074">ë² ì´ì§• / ì¤‘êµ­</option>
          <option value="31.2304,121.4737">ìƒí•˜ì´ / ì¤‘êµ­</option>
          <option value="1.3521,103.8198">ì‹±ê°€í¬ë¥´</option>
          <option value="40.7128,-74.006">ë‰´ìš• / ë¯¸êµ­</option>
          <option value="34.0522,-118.2437">LA / ë¯¸êµ­</option>
          <option value="51.5074,-0.1278">ëŸ°ë˜ / ì˜êµ­</option>
          <option value="48.8566,2.3522">íŒŒë¦¬ / í”„ë‘ìŠ¤</option>
          <option value="custom">ì§ì ‘ ì…ë ¥ (ìœ„ë„/ê²½ë„)</option>
        </select>
      </div>

      <!-- ê³„ì‚° ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸° -->
      <div class="chart-preview" id="chartPreview">
        <div class="chart-preview-title">âœ¦ ê³„ì‚°ëœ ì¶œìƒ ì°¨íŠ¸</div>
        <div class="chart-preview-signs" id="chartPreviewSigns"></div>
        <div style="font-size:0.78rem;color:rgba(196,181,253,0.5);margin-top:4px;">
          â€» ì²œë¬¸ ê³„ì‚° ê²°ê³¼ (Swiss Ephemeris ë°©ì‹)
        </div>
      </div>

    </div>
    <!-- /birth-form -->

    <!-- ì´ˆë³´ì ì•ˆë‚´ ë°°ë„ˆ -->
    <div class="guide-banner" onclick="this.classList.toggle('open')">
      <div class="guide-title">
        <span>ğŸ’¡</span>
        <span>ì„¸ ë³„ìë¦¬ê°€ ì²˜ìŒì´ì‹ ê°€ìš”? í´ë¦­í•´ì„œ í™•ì¸í•˜ì„¸ìš”</span>
        <span class="guide-arrow">â–¾</span>
      </div>
      <div class="guide-content">
        <div class="guide-row">
          <span class="gr-icon">â˜€ï¸</span>
          <span class="gr-label">íƒœì–‘ê¶</span>
          <span class="gr-desc" style="font-size:0.9rem;line-height:1.7;">ìƒë…„ì›”ì¼ë¡œ ê²°ì •ë˜ëŠ” <b style="color:var(--silver)">ë‚˜ì˜ ë³¸ì§ˆÂ·ì„±ê²©</b>. ê°€ì¥ ì˜ ì•Œë ¤ì§„ ë³„ìë¦¬ì˜ˆìš”. ìƒì¼ì´ ëª‡ ì›”ì¸ì§€ë§Œ ì•Œë©´ ë°”ë¡œ ì„ íƒ ê°€ëŠ¥í•©ë‹ˆë‹¤.</span>
        </div>
        <div class="guide-row">
          <span class="gr-icon">ğŸŒ™</span>
          <span class="gr-label">ë‹¬ê¶</span>
          <span class="gr-desc" style="font-size:0.9rem;line-height:1.7;">ì¶œìƒ ë‹¹ì‹œ ë‹¬ì˜ ìœ„ì¹˜. <b style="color:var(--silver)">ê°ì •Â·ë¬´ì˜ì‹Â·ì†ë§ˆìŒ</b>ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ìƒë…„ì›”ì¼+ì¶œìƒì‹œê°„ìœ¼ë¡œ ê³„ì‚°í•´ìš”. ëª¨ë¥´ë©´ ë¬´ë£Œ ë‹¬ê¶ ê³„ì‚°ê¸°ë¥¼ ê²€ìƒ‰í•´ë³´ì„¸ìš”.</span>
        </div>
        <div class="guide-row">
          <span class="gr-icon">â†‘</span>
          <span class="gr-label">ìƒìŠ¹ê¶</span>
          <span class="gr-desc" style="font-size:0.9rem;line-height:1.7;">ì¶œìƒ ì‹œê°ì˜ ë™ìª½ ì§€í‰ì„  ë³„ìë¦¬. <b style="color:var(--silver)">íƒ€ì¸ì—ê²Œ ë³´ì´ëŠ” ì¸ìƒÂ·ì™¸ë©´</b>. ì •í™•í•œ ì¶œìƒ ì‹œê°ì´ í•„ìš”í•˜ë©°, ëª°ë¼ë„ ë¶„ì„ì´ ê°€ëŠ¥í•´ìš”!</span>
        </div>
      </div>
    </div>

    <div class="signs-grid">
      <!-- íƒœì–‘ê¶ -->
      <div class="sign-card sun">
        <div class="card-label">
          <span class="card-dot"></span>
          â˜€ï¸ íƒœì–‘ê¶ <small style="opacity:0.6">ë‚˜ì˜ ë³¸ì§ˆ</small>
        </div>
        <div class="custom-select-wrap">
          <div class="custom-trigger" id="sunTrigger" onclick="toggleDropdown('sun')">
            <span class="placeholder">ìƒì¼ë¡œ ì„ íƒ â–¸</span>
          </div>
        </div>
        <input type="hidden" id="sunSign" value="">
        <div class="sign-info-card" id="sunInfo"></div>
      </div>

      <!-- ë‹¬ê¶ -->
      <div class="sign-card moon">
        <div class="card-label">
          <span class="card-dot"></span>
          ğŸŒ™ ë‹¬ê¶ <small style="opacity:0.6">ë‚´ë©´ ê°ì •</small>
        </div>
        <div class="custom-select-wrap">
          <div class="custom-trigger" id="moonTrigger" onclick="toggleDropdown('moon')">
            <span class="placeholder">ê°ì • ìŠ¤íƒ€ì¼ ì„ íƒ â–¸</span>
          </div>
        </div>
        <input type="hidden" id="moonSign" value="">
        <div class="sign-info-card" id="moonInfo"></div>
      </div>

      <!-- ìƒìŠ¹ê¶ -->
      <div class="sign-card rising">
        <div class="card-label">
          <span class="card-dot"></span>
          â†‘ ìƒìŠ¹ê¶ <small style="opacity:0.6">íƒ€ì¸ì´ ë³¸ ë‚˜</small>
        </div>
        <div class="custom-select-wrap">
          <div class="custom-trigger" id="risingTrigger" onclick="toggleDropdown('rising')">
            <span class="placeholder">ëª°ë¼ë„ ê´œì°®ì•„ìš” âœ“</span>
          </div>
        </div>
        <input type="hidden" id="risingSign" value="">
        <div class="sign-info-card" id="risingInfo"></div>
      </div>
    </div>

    <!-- ê³ ë¯¼ ì…ë ¥ -->
    <div class="concern-box">
      <label>ğŸ“ í˜„ì¬ ê°€ì¥ í° ê³ ë¯¼ì´ë‚˜ ì§ˆë¬¸ (ì„ íƒ)</label>
      <textarea id="concern" rows="3" placeholder="ì˜ˆ: ì´ì§ì„ ê³ ë¯¼ ì¤‘ì…ë‹ˆë‹¤ / ìƒˆë¡œìš´ ì¸ì—°ì´ ìƒê¸¸ê¹Œìš” / ì§€ê¸ˆì˜ ì„ íƒì´ ë§ëŠ” ê±¸ê¹Œìš”..."></textarea>
    </div>

    <button class="btn-analyze" id="analyzeBtn" onclick="analyze()">
      âœ¦ ìš´ëª…ì˜ ê·¸ë¬¼ í¼ì¹˜ê¸°
    </button>
    <div class="error-msg" id="errorMsg"></div>
  </div>

  <!-- ë¡œë”© -->
  <div class="loading-state" id="loadingState">
    <div class="orbit-loader">
      <div class="planet"></div>
      <div class="planet"></div>
      <div class="planet"></div>
    </div>
    <div class="loading-steps">
      <div class="loading-step" id="step1"><span class="dot"></span> ì„¸ ë³„ìë¦¬ ë…¸ë“œ êµ¬ì„± ì¤‘...</div>
      <div class="loading-step" id="step2"><span class="dot"></span> í–‰ì„± ì§€ë°° ê´€ê³„ ê·¸ë˜í”„ íƒìƒ‰ ì¤‘...</div>
      <div class="loading-step" id="step3"><span class="dot"></span> ì›ì†ŒÂ·ì„±ì§ˆ ì—°ê²°ë§ ë¶„ì„ ì¤‘...</div>
      <div class="loading-step" id="step4"><span class="dot"></span> ì‚¼ê° ê´€ê³„ ì—ë„ˆì§€ í•´ì„ ì¤‘...</div>
      <div class="loading-step" id="step5"><span class="dot"></span> ìš´ëª… ê²½ë¡œ ì‹œê°í™” ì¤€ë¹„ ì¤‘...</div>
    </div>
  </div>

  <!-- ê²°ê³¼ -->
  <div class="result-section" id="resultSection">

    <!-- ê·¸ë˜í”„ ì‹œê°í™” -->
    <div class="graph-container">
      <div class="graph-header">
        <div class="pulse-dot"></div>
        <h3>ìš´ëª…ì˜ ê´€ê³„ë§ â€” ì¶”ë¡  ê²½ë¡œ ì‹œê°í™”</h3>
      </div>
      <div id="graph-canvas"></div>
    </div>

    <!-- ê²½ë¡œ íƒœê·¸ -->
    <div class="path-tags" id="pathTags"></div>

    <!-- ë¶„ì„ ì¹´ë“œë“¤ -->
    <div class="analysis-cards" id="analysisCards"></div>

    <!-- ì¹´ì¹´ì˜¤ ê³µìœ  ì„¹ì…˜ -->
    <div class="share-section">
      <p class="share-title">âœ¨ ë‚˜ì˜ ìš´ì„¸ ê²°ê³¼ë¥¼ ì¹œêµ¬ì—ê²Œ ê³µìœ í•´ë³´ì„¸ìš”</p>
      <div class="share-buttons">
        <button class="btn-kakao" onclick="shareKakao()">
          ğŸ’¬  ì¹´ì¹´ì˜¤í†¡ Â· ê³µìœ í•˜ê¸°
        </button>
        <button class="btn-copy-link" onclick="copyLink()">
          ğŸ”— ë§í¬ ë³µì‚¬
        </button>
      </div>
      <p class="share-hint" id="copyMsg" style="display:none;color:#6ee7b7;font-size:0.9rem;margin-top:8px;">
        âœ“ ë§í¬ê°€ ë³µì‚¬ëìŠµë‹ˆë‹¤!
      </p>
    </div>

    <button class="btn-reset" onclick="reset()">â†º ë‹¤ì‹œ ë¶„ì„í•˜ê¸°</button>
  </div>
</div>

<script>
// ===== ë³„ ë°°ê²½ =====
const canvas = document.getElementById('starfield');
const ctx = canvas.getContext('2d');
let stars = [];

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}

function initStars() {
  stars = [];
  for (let i = 0; i < 200; i++) {
    stars.push({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      r: Math.random() * 1.2,
      a: Math.random(),
      speed: Math.random() * 0.003 + 0.001
    });
  }
}

function drawStars() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  stars.forEach(s => {
    s.a += s.speed;
    const alpha = (Math.sin(s.a) + 1) / 2 * 0.7 + 0.1;
    ctx.beginPath();
    ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
    ctx.fillStyle = `rgba(196,181,253,${alpha})`;
    ctx.fill();
  });
  requestAnimationFrame(drawStars);
}

window.addEventListener('resize', () => { resizeCanvas(); initStars(); });
resizeCanvas(); initStars(); drawStars();


// ===== ë³„ìë¦¬ í’€ ë°ì´í„° (ì„¤ëª… í¬í•¨) =====
const SIGN_DATA = {
  'ì–‘ìë¦¬':    { element:'ë¶ˆ',   quality:'í™œë™', ruler:'í™”ì„±',   symbol:'â™ˆ', color:'#ef4444',
    date:'3/21 â€“ 4/19', keywords:['ì—´ì •','ê°œì²™','ì¶©ë™','ë¦¬ë”ì‹­'],
    moon_desc:'ì¦‰ê°ì Â·ì¶©ë™ì  ê°ì •, ë¹ ë¥¸ ë¶„ë…¸ì™€ ë¹ ë¥¸ í•´ì†Œ',
    rising_desc:'í™œê¸°ì°¨ê³  ê°•ë ¬í•œ ì²«ì¸ìƒ, ëˆˆë¹›ì´ ë‚ ì¹´ë¡­ë‹¤' },
  'í™©ì†Œìë¦¬':  { element:'í™',   quality:'ê³ ì •', ruler:'ê¸ˆì„±',   symbol:'â™‰', color:'#84cc16',
    date:'4/20 â€“ 5/20', keywords:['ì•ˆì •','ê°ê°','ì¸ë‚´','í˜„ì‹¤'],
    moon_desc:'ì•ˆì •Â·ì‹ ë¢° ì¶”êµ¬, ê°ì • ë³€í™” ëŠë¦¬ê³  ê¹ŠìŒ',
    rising_desc:'ë¯¿ìŒì§í•˜ê³  í¸ì•ˆí•œ ì¸ìƒ, ëª©ì†Œë¦¬ê°€ ë¶€ë“œëŸ½ë‹¤' },
  'ìŒë‘¥ì´ìë¦¬':{ element:'ë°”ëŒ', quality:'ë³€í†µ', ruler:'ìˆ˜ì„±',   symbol:'â™Š', color:'#facc15',
    date:'5/21 â€“ 6/21', keywords:['ì†Œí†µ','ì§€ì‹','ë‹¤ì–‘ì„±','ì¬ì¹˜'],
    moon_desc:'ë³€ë•ìŠ¤ëŸ¬ìš´ ê°ì •, ë§ë¡œ ê°ì •ì„ ì²˜ë¦¬í•¨',
    rising_desc:'ë§ ë¹ ë¥´ê³  í‘œì • í’ë¶€, ëˆˆì´ í˜¸ê¸°ì‹¬ìœ¼ë¡œ ë°˜ì§' },
  'ê²Œìë¦¬':    { element:'ë¬¼',   quality:'í™œë™', ruler:'ë‹¬',     symbol:'â™‹', color:'#93c5fd',
    date:'6/22 â€“ 7/22', keywords:['ê°ì •','ê°€ì¡±','ë³´í˜¸','ì§ê´€'],
    moon_desc:'ì„¬ì„¸í•˜ê³  í’ë¶€í•œ ê°ì •, ê°ìˆ˜ì„±ì´ ë§¤ìš° ë†’ìŒ',
    rising_desc:'ë¶€ë“œëŸ½ê³  ë”°ëœ»í•œ ì¸ìƒ, ë°°ë ¤ì‹¬ì´ ì²«ëˆˆì— ë³´ì„' },
  'ì‚¬ììë¦¬':  { element:'ë¶ˆ',   quality:'ê³ ì •', ruler:'íƒœì–‘',   symbol:'â™Œ', color:'#fb923c',
    date:'7/23 â€“ 8/22', keywords:['ì°½ì˜','í‘œí˜„','ìë¶€ì‹¬','ê´€ëŒ€'],
    moon_desc:'ë“œë¼ë§ˆí‹±í•œ ê°ì • í‘œí˜„, ì¸ì •ë°›ê³  ì‹¶ì€ ìš•êµ¬',
    rising_desc:'ìì‹ ê° ë„˜ì¹˜ëŠ” ì¹´ë¦¬ìŠ¤ë§ˆ, ì¡´ì¬ê°ì´ ê°•í•˜ë‹¤' },
  'ì²˜ë…€ìë¦¬':  { element:'í™',   quality:'ë³€í†µ', ruler:'ìˆ˜ì„±',   symbol:'â™', color:'#a3e635',
    date:'8/23 â€“ 9/22', keywords:['ë¶„ì„','ë´‰ì‚¬','ì™„ë²½','ê±´ê°•'],
    moon_desc:'ê±±ì •Â·ë¶„ì„ì  ê°ì •, ì„¸ì„¸í•œ ê²ƒì— ì˜ˆë¯¼',
    rising_desc:'ë‹¨ì •í•˜ê³  ì°¨ë¶„í•œ ì¸ìƒ, ê¼¼ê¼¼í•´ ë³´ì¸ë‹¤' },
  'ì²œì¹­ìë¦¬':  { element:'ë°”ëŒ', quality:'í™œë™', ruler:'ê¸ˆì„±',   symbol:'â™', color:'#f9a8d4',
    date:'9/23 â€“ 10/23', keywords:['ê· í˜•','ê´€ê³„','ë¯¸í•™','ê³µì •'],
    moon_desc:'ì¡°í™” ì¶”êµ¬, ê²°ì • ë§ì„¤ì„, ê´€ê³„ì—ì„œ ê°ì • ì¶©ì „',
    rising_desc:'ì„¸ë ¨ë˜ê³  ìš°ì•„í•œ ì²«ì¸ìƒ, ê· í˜• ì¡íŒ ì™¸ëª¨' },
  'ì „ê°ˆìë¦¬':  { element:'ë¬¼',   quality:'ê³ ì •', ruler:'ëª…ì™•ì„±', symbol:'â™', color:'#c084fc',
    date:'10/24 â€“ 11/21', keywords:['ë³€í™˜','ì‹¬ì¸µ','ì§‘ì¤‘','ë¹„ë°€'],
    moon_desc:'ê°•ë ¬í•˜ê³  ê¹Šì€ ê°ì •, ì‰½ê²Œ ë“œëŸ¬ë‚´ì§€ ì•ŠìŒ',
    rising_desc:'ì‹ ë¹„ë¡­ê³  ê°•ë ¬í•œ ëˆˆë¹›, ê¿°ëš«ì–´ë³´ëŠ” ì¸ìƒ' },
  'ì‚¬ìˆ˜ìë¦¬':  { element:'ë¶ˆ',   quality:'ë³€í†µ', ruler:'ëª©ì„±',   symbol:'â™', color:'#fbbf24',
    date:'11/22 â€“ 12/21', keywords:['ììœ ','ëª¨í—˜','ì² í•™','ë‚™ê´€'],
    moon_desc:'ììœ ë¡­ê³  ë‚™ì²œì  ê°ì •, êµ¬ì†ë°›ìœ¼ë©´ ë‹µë‹µí•´í•¨',
    rising_desc:'í™œë‹¬í•˜ê³  ìœ ë¨¸ ë„˜ì¹˜ëŠ” ì¸ìƒ, ì›ƒìŒì´ í¬ë‹¤' },
  'ì—¼ì†Œìë¦¬':  { element:'í™',   quality:'í™œë™', ruler:'í† ì„±',   symbol:'â™‘', color:'#94a3b8',
    date:'12/22 â€“ 1/19', keywords:['ì•¼ë§','ê·œìœ¨','ì±…ì„','í˜„ì‹¤'],
    moon_desc:'ê°ì •ì„ í†µì œÂ·ì ˆì œ, ë‚´ë©´ì€ ê¹Šì€ ì™¸ë¡œì›€',
    rising_desc:'ì§„ì§€í•˜ê³  ì‹ ë¢°ê° ìˆëŠ” ì¸ìƒ, ë‚˜ì´ë³´ë‹¤ ì„±ìˆ™í•´ ë³´ì„' },
  'ë¬¼ë³‘ìë¦¬':  { element:'ë°”ëŒ', quality:'ê³ ì •', ruler:'ì²œì™•ì„±', symbol:'â™’', color:'#67e8f9',
    date:'1/20 â€“ 2/18', keywords:['í˜ì‹ ','ë…ë¦½','ì¸ë„ì£¼ì˜','ë¯¸ë˜'],
    moon_desc:'ë¶„ë¦¬ëœ ë“¯í•œ ê°ì •, ì§‘ë‹¨ë³´ë‹¤ ì´ë…ì— ë°˜ì‘',
    rising_desc:'ë…íŠ¹í•˜ê³  ê°œì„± ê°•í•œ ì¸ìƒ, íŠ€ëŠ” ìŠ¤íƒ€ì¼' },
  'ë¬¼ê³ ê¸°ìë¦¬':{ element:'ë¬¼',   quality:'ë³€í†µ', ruler:'í•´ì™•ì„±', symbol:'â™“', color:'#a78bfa',
    date:'2/19 â€“ 3/20', keywords:['ì˜ì„±','ê³µê°','ì§ê´€','ì˜ˆìˆ '],
    moon_desc:'ê²½ê³„ ì—†ëŠ” ê³µê° ëŠ¥ë ¥, ê°ì • í¡ìˆ˜ê°€ ê°•í•¨',
    rising_desc:'ëª½í™˜ì ì´ê³  ë¶€ë“œëŸ¬ìš´ ì¸ìƒ, ëˆˆì´ ê¹Šê³  í‘œì •ì´ ìœ ì—°' },
};

// ===== ì»¤ìŠ¤í…€ ë“œë¡­ë‹¤ìš´ =====
function buildDropdownItems(type) {
  const signs = Object.keys(SIGN_DATA);
  let html = '';
  if (type === 'rising') {
    html += `<div class="dropdown-item" data-value="" onclick="selectSign('rising','')">
      <span class="di-symbol">âœ•</span>
      <span class="di-name">ì„ íƒ ì•ˆ í•¨</span>
      <span class="di-badge">ìƒëµ ê°€ëŠ¥</span>
      <span class="di-desc">ìƒìŠ¹ê¶ì„ ëª¨ë¥´ë©´ ìƒëµí•´ë„ ë¶„ì„ë©ë‹ˆë‹¤</span>
    </div>`;
  }
  signs.forEach(sign => {
    const d = SIGN_DATA[sign];
    let badge = '', desc = '';
    if (type === 'sun') {
      badge = d.date;
      desc = d.element + 'Â·' + d.quality + ' / ' + d.ruler + ' ì§€ë°° / ' + d.keywords.slice(0,2).join('Â·');
    } else if (type === 'moon') {
      badge = d.element + ' ê°ì •';
      desc = d.moon_desc;
    } else {
      badge = d.element + 'Â·ì™¸ë©´';
      desc = d.rising_desc;
    }
    html += `<div class="dropdown-item" data-value="${sign}" onclick="selectSign('${type}','${sign}')">
      <span class="di-symbol">${d.symbol}</span>
      <span class="di-name">${sign}</span>
      <span class="di-badge">${badge}</span>
      <span class="di-desc">${desc}</span>
    </div>`;
  });
  return html;
}

// â”€â”€ ë“œë¡­ë‹¤ìš´ í¬í„¸ ìƒì„± (bodyì— ì§ì ‘ ë¶™ì„)
function createPortal(type) {
  const existing = document.getElementById(type + 'Dropdown');
  if (existing) return existing;

  const el = document.createElement('div');
  el.className = 'dropdown-portal';
  el.id = type + 'Dropdown';
  el.innerHTML = buildDropdownItems(type);
  document.body.appendChild(el);
  return el;
}

function initDropdowns() {
  ['sun','moon','rising'].forEach(type => createPortal(type));
}

function positionDropdown(type) {
  const dropdown = document.getElementById(type + 'Dropdown');
  const trigger  = document.getElementById(type + 'Trigger');
  if (!dropdown || !trigger) return;

  const rect    = trigger.getBoundingClientRect();
  const padding = 8;
  const maxH    = Math.min(window.innerHeight * 0.55, 400);

  // ë„ˆë¹„: íŠ¸ë¦¬ê±°ì™€ ë™ì¼, ìµœì†Œ 260px
  const dropW = Math.max(rect.width, 260);
  // ì™¼ìª½ ìœ„ì¹˜: í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ì§€ ì•Šê²Œ
  let leftPos = rect.left;
  if (leftPos + dropW > window.innerWidth - padding) {
    leftPos = window.innerWidth - padding - dropW;
  }
  leftPos = Math.max(padding, leftPos);

  // ì•„ë˜ ê³µê°„ í™•ì¸
  const spaceBelow = window.innerHeight - rect.bottom - padding;
  let topPos;
  if (spaceBelow >= 150) {
    topPos = rect.bottom + 4;
  } else {
    // ìœ„ë¡œ í¼ì¹˜ê¸°
    topPos = Math.max(padding, rect.top - maxH - 4);
  }

  dropdown.style.left      = leftPos + 'px';
  dropdown.style.top       = topPos  + 'px';
  dropdown.style.width     = dropW   + 'px';
  dropdown.style.maxHeight = maxH    + 'px';
}

function toggleDropdown(type) {
  const dropdown = document.getElementById(type + 'Dropdown');
  const trigger  = document.getElementById(type + 'Trigger');
  const isOpen   = dropdown.classList.contains('open');

  // ëª¨ë‘ ë‹«ê¸°
  ['sun','moon','rising'].forEach(t => {
    const dd = document.getElementById(t + 'Dropdown');
    const tr = document.getElementById(t + 'Trigger');
    if (dd) dd.classList.remove('open');
    if (tr) tr.classList.remove('open');
  });

  if (!isOpen) {
    positionDropdown(type);
    dropdown.classList.add('open');
    trigger.classList.add('open');
  }
}

// ìŠ¤í¬ë¡¤/ë¦¬ì‚¬ì´ì¦ˆ ì‹œ ì—´ë¦° ë“œë¡­ë‹¤ìš´ ìœ„ì¹˜ ì¬ê³„ì‚°
['scroll','resize'].forEach(ev => {
  window.addEventListener(ev, function() {
    ['sun','moon','rising'].forEach(t => {
      const dd = document.getElementById(t + 'Dropdown');
      if (dd && dd.classList.contains('open')) positionDropdown(t);
    });
  }, { passive: true });
});

document.addEventListener('click', function(e) {
  // íŠ¸ë¦¬ê±° ë˜ëŠ” í¬í„¸ ë“œë¡­ë‹¤ìš´ í´ë¦­ì´ë©´ ë‹«ì§€ ì•ŠìŒ
  if (!e.target.closest('.custom-select-wrap') && !e.target.closest('.dropdown-portal')) {
    ['sun','moon','rising'].forEach(t => {
      const dd = document.getElementById(t + 'Dropdown');
      const tr = document.getElementById(t + 'Trigger');
      if (dd) dd.classList.remove('open');
      if (tr) tr.classList.remove('open');
    });
  }
});

function selectSign(type, value) {
  const trigger  = document.getElementById(type + 'Trigger');
  const hidden   = document.getElementById(type + 'Sign');
  const infoCard = document.getElementById(type + 'Info');
  hidden.value = value;
  document.getElementById(type + 'Dropdown').classList.remove('open');
  trigger.classList.remove('open');
  document.querySelectorAll('#' + type + 'Dropdown .dropdown-item').forEach(el => {
    el.classList.toggle('selected', el.dataset.value === value);
  });
  if (!value) {
    trigger.innerHTML = `<span class="placeholder">ëª°ë¼ë„ ê´œì°®ì•„ìš” âœ“</span>`;
    infoCard.classList.remove('visible');
    return;
  }
  const d = SIGN_DATA[value];
  let hint = '';
  if (type === 'sun')       hint = d.date;
  else if (type === 'moon') hint = d.moon_desc.split(',')[0].split('Â·')[0];
  else                      hint = d.rising_desc.split(',')[0].split('Â·')[0];
  trigger.innerHTML = `<span class="selected-symbol">${d.symbol}</span><span class="selected-name">${value}</span><span class="selected-hint">${hint}</span>`;
  let infoHTML = '';
  if (type === 'sun') {
    infoHTML = `<div class="sic-row"><span class="sic-label">ìƒì¼</span><span class="sic-val">${d.date}</span></div>
      <div class="sic-row"><span class="sic-label">ì›ì†Œ</span><span class="sic-val">${d.element} Â· ${d.quality}ê¶</span></div>
      <div class="sic-row"><span class="sic-label">ì§€ë°°</span><span class="sic-val">${d.ruler} ì§€ë°°</span></div>
      <div class="sic-keywords">${d.keywords.map(k => '<span class="kw">'+k+'</span>').join('')}</div>`;
  } else if (type === 'moon') {
    infoHTML = `<div class="sic-row"><span class="sic-label">ê°ì •</span><span class="sic-val">${d.moon_desc}</span></div>
      <div class="sic-row"><span class="sic-label">ì›ì†Œ</span><span class="sic-val">${d.element} Â· ${d.ruler} ì§€ë°°</span></div>
      <div class="sic-keywords">${d.keywords.map(k => '<span class="kw">'+k+'</span>').join('')}</div>`;
  } else {
    infoHTML = `<div class="sic-row"><span class="sic-label">ì¸ìƒ</span><span class="sic-val">${d.rising_desc}</span></div>
      <div class="sic-row"><span class="sic-label">ì›ì†Œ</span><span class="sic-val">${d.element} Â· ${d.ruler} ì§€ë°°</span></div>
      <div class="sic-keywords">${d.keywords.map(k => '<span class="kw">'+k+'</span>').join('')}</div>`;
  }
  infoCard.innerHTML = infoHTML;
  infoCard.classList.add('visible');
}

initDropdowns();

function getAspect(s1, s2) {
  const signs = Object.keys(SIGN_DATA);
  const i1 = signs.indexOf(s1), i2 = signs.indexOf(s2);
  const diff = Math.abs(i1 - i2);
  const angle = Math.min(diff, 12 - diff) * 30;
  if (angle === 0) return { name: 'í•©(Conjunction)', harmony: 1.0, desc: 'ì—ë„ˆì§€ ì¦í­' };
  if (angle === 60) return { name: 'ìœ¡ë¶„(Sextile)', harmony: 0.8, desc: 'ì¡°í™”ë¡œìš´ í˜‘ë ¥' };
  if (angle === 90) return { name: 'ì§ê°(Square)', harmony: 0.3, desc: 'ê¸´ì¥ê³¼ ì„±ì¥' };
  if (angle === 120) return { name: 'ì‚¼ë¶„(Trine)', harmony: 0.95, desc: 'ì²œë¶€ì  íë¦„' };
  if (angle === 180) return { name: 'ëŒ€ë¦½(Opposition)', harmony: 0.5, desc: 'ê· í˜•ê³¼ ëŒ€ì¡°' };
  return { name: 'ë§ˆì´ë„ˆ ê°ë„', harmony: 0.6, desc: 'ë¯¸ë¬˜í•œ ì—°ê²°' };
}

// ===== ê·¸ë˜í”„ ê·¸ë¦¬ê¸° =====
function drawGraph(sun, moon, rising) {
  const container = document.getElementById('graph-canvas');
  if (typeof vis === 'undefined') {
    container.innerHTML = '<div style="height:100%;display:flex;align-items:center;justify-content:center;color:rgba(196,181,253,0.5);font-size:0.85rem;">â˜ï¸ ê·¸ë˜í”„ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë”© ì¤‘... (ê²°ê³¼ëŠ” ì•„ë˜ì—ì„œ í™•ì¸í•˜ì„¸ìš”)</div>';
    return;
  }
  const sunData = SIGN_DATA[sun];
  const moonData = SIGN_DATA[moon];
  const risingData = rising ? SIGN_DATA[rising] : null;

  const nodes = [
    { id: 1, label: `â˜€ï¸ íƒœì–‘ê¶\n${sun}`, color: { background: 'rgba(251,191,36,0.15)', border: '#fbbf24', highlight: { background: 'rgba(251,191,36,0.3)', border: '#fbbf24' }}, font: { color: '#fde68a', size: 13, face: 'Noto Sans KR' }, shape: 'ellipse', size: 38 },
    { id: 2, label: `ğŸŒ™ ë‹¬ê¶\n${moon}`,  color: { background: 'rgba(147,197,253,0.15)', border: '#93c5fd', highlight: { background: 'rgba(147,197,253,0.3)', border: '#93c5fd' }}, font: { color: '#bfdbfe', size: 13, face: 'Noto Sans KR' }, shape: 'ellipse', size: 34 },
  ];

  const edges = [];

  const sunMoon = getAspect(sun, moon);
  edges.push({ from: 1, to: 2, label: sunMoon.name, color: { color: sunMoon.harmony > 0.7 ? '#6ee7b7' : sunMoon.harmony > 0.4 ? '#fbbf24' : '#f87171', opacity: 0.8 }, font: { color: 'rgba(196,181,253,0.8)', size: 10, face: 'Noto Sans KR' }, dashes: sunMoon.harmony < 0.5 });

  if (risingData) {
    nodes.push({ id: 3, label: `â†‘ ìƒìŠ¹ê¶\n${rising}`, color: { background: 'rgba(110,231,183,0.15)', border: '#6ee7b7', highlight: { background: 'rgba(110,231,183,0.3)', border: '#6ee7b7' }}, font: { color: '#a7f3d0', size: 13, face: 'Noto Sans KR' }, shape: 'ellipse', size: 30 });
    const sunRising = getAspect(sun, rising);
    const moonRising = getAspect(moon, rising);
    edges.push({ from: 1, to: 3, label: sunRising.name, color: { color: sunRising.harmony > 0.7 ? '#6ee7b7' : sunRising.harmony > 0.4 ? '#fbbf24' : '#f87171', opacity: 0.8 }, font: { color: 'rgba(196,181,253,0.8)', size: 10, face: 'Noto Sans KR' }, dashes: sunRising.harmony < 0.5 });
    edges.push({ from: 2, to: 3, label: moonRising.name, color: { color: moonRising.harmony > 0.7 ? '#6ee7b7' : moonRising.harmony > 0.4 ? '#fbbf24' : '#f87171', opacity: 0.8 }, font: { color: 'rgba(196,181,253,0.8)', size: 10, face: 'Noto Sans KR' }, dashes: moonRising.harmony < 0.5 });
  }

  // ì§€ë°° í–‰ì„± ë…¸ë“œ ì¶”ê°€
  const rulers = [...new Set([sunData.ruler, moonData.ruler, risingData?.ruler].filter(Boolean))];
  rulers.forEach((ruler, i) => {
    nodes.push({ id: 10+i, label: `â¬¡ ${ruler}`, color: { background: 'rgba(107,33,168,0.2)', border: '#9333ea', highlight: { background: 'rgba(107,33,168,0.4)', border: '#9333ea' }}, font: { color: '#d8b4fe', size: 11, face: 'Noto Sans KR' }, shape: 'diamond', size: 20 });
    if (SIGN_DATA[sun]?.ruler === ruler) edges.push({ from: 1, to: 10+i, color: { color: '#9333ea', opacity: 0.4 }, dashes: [2,4] });
    if (SIGN_DATA[moon]?.ruler === ruler) edges.push({ from: 2, to: 10+i, color: { color: '#9333ea', opacity: 0.4 }, dashes: [2,4] });
    if (risingData?.ruler === ruler) edges.push({ from: 3, to: 10+i, color: { color: '#9333ea', opacity: 0.4 }, dashes: [2,4] });
  });

  const data = { nodes: new vis.DataSet(nodes), edges: new vis.DataSet(edges) };
  const options = {
    physics: { stabilization: { iterations: 100 }, barnesHut: { gravitationalConstant: -3000, springLength: 120 } },
    interaction: { hover: true, tooltipDelay: 200 },
    layout: { improvedLayout: true },
    edges: { smooth: { type: 'curvedCW', roundness: 0.2 }, arrows: { to: false }, width: 1.5 },
    background: { color: 'transparent' },
  };

  container.innerHTML = '';
  new vis.Network(container, data, options);
}

// ===== ê²½ë¡œ íƒœê·¸ =====
function buildPathTags(sun, moon, rising) {
  const container = document.getElementById('pathTags');
  const sunD = SIGN_DATA[sun], moonD = SIGN_DATA[moon];

  const tags = [
    `â˜€ï¸ ${sun} (${sunD.element}Â·${sunD.quality}Â·${sunD.ruler} ì§€ë°°)`,
    `â†’`,
    `ğŸŒ™ ${moon} (${moonD.element}Â·${moonD.quality}Â·${moonD.ruler} ì§€ë°°)`,
  ];

  if (rising && SIGN_DATA[rising]) {
    const risingD = SIGN_DATA[rising];
    tags.push(`â†’`);
    tags.push(`â†‘ ${rising} (${risingD.element}Â·${risingD.quality}Â·${risingD.ruler} ì§€ë°°)`);
  }

  container.innerHTML = tags.map((t, i) =>
    t === 'â†’'
      ? `<span class="path-tag"><span class="connector">â€”â†’â€”</span></span>`
      : `<span class="path-tag">${t}</span>`
  ).join('');
}

// ===== ë©”ì¸ ë¶„ì„ í•¨ìˆ˜ =====
async function analyze() {
  const concern = document.getElementById('concern').value.trim();
  const isBirthMode = document.getElementById('tabBirth').classList.contains('active');

  let requestBody, sun, moon, rising;

  if (isBirthMode) {
    // â”€â”€ ìƒë…„ì›”ì¼ ìë™ ê³„ì‚° ëª¨ë“œ
    const year   = parseInt(document.getElementById('birthYear').value);
    const month  = parseInt(document.getElementById('birthMonth').value);
    const day    = parseInt(document.getElementById('birthDay').value);
    if (!year || !month || !day) {
      showError('ìƒë…„ì›”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš” ğŸ‚');
      return;
    }
    const known  = document.getElementById('timeKnown').checked;
    const hour   = known ? (parseInt(document.getElementById('birthHour').value)   || 12) : 12;
    const minute = known ? (parseInt(document.getElementById('birthMinute').value) || 0)  : 0;
    const city   = document.getElementById('birthCity').value;
    let lat = 37.5665, lon = 126.978;
    if (city && city !== 'custom') { [lat, lon] = city.split(',').map(Number); }

    // í´ë¼ì´ì–¸íŠ¸ ê³„ì‚°ìœ¼ë¡œ ë³„ìë¦¬ ë¯¸ë¦¬ ì•Œì•„ë‘ê¸° (ë¡œë”© ì¤‘ í‘œì‹œìš©)
    const chart = calcChart(year, month, day, hour, minute, lat, lon);
    sun    = chart.sun;
    moon   = chart.moon;
    rising = known ? chart.rising : null;

    requestBody = {
      birth: { year, month, day, hour, minute, lat, lon, tzOffset: 9,
               timeUnknown: !known },
      concern
    };
  } else {
    // â”€â”€ ìˆ˜ë™ ì„ íƒ ëª¨ë“œ (ê¸°ì¡´ ë°©ì‹ ê·¸ëŒ€ë¡œ)
    sun    = document.getElementById('sunSign').value;
    moon   = document.getElementById('moonSign').value;
    rising = document.getElementById('risingSign').value;
    if (!sun || !moon) {
      showError('íƒœì–‘ê¶ê³¼ ë‹¬ê¶ì„ ì„ íƒí•´ì£¼ì„¸ìš” âœ¦');
      return;
    }
    requestBody = { sun, moon, rising, concern };
  }

  document.getElementById('inputSection').style.display = 'none';
  document.getElementById('resultSection').classList.remove('active');
  showLoading();

  // API ì—”ë“œí¬ì¸íŠ¸ ì„ íƒ
  const apiEndpoint = isBirthMode ? '/api/fortune-v2' : '/api/fortune';

  try {
    const response = await fetch(apiEndpoint, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(requestBody)
    });

    const data = await response.json();

    if (!response.ok) {
      hideLoading();
      document.getElementById('inputSection').style.display = 'block';
      showError(data.error || 'ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      return;
    }

    hideLoading();
    showResult(data, sun, moon, rising);

  } catch (err) {
    hideLoading();
    document.getElementById('inputSection').style.display = 'block';
    showError('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ' + (err.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜') + ' â€” ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
  }
}

function showLoading() {
  const el = document.getElementById('loadingState');
  el.classList.add('active');
  const steps = ['step1','step2','step3','step4','step5'];
  let i = 0;
  const interval = setInterval(() => {
    if (i < steps.length) {
      document.getElementById(steps[i]).classList.add('active');
      i++;
    } else {
      clearInterval(interval);
    }
  }, 700);
}

function hideLoading() {
  document.getElementById('loadingState').classList.remove('active');
  ['step1','step2','step3','step4','step5'].forEach(s => document.getElementById(s).classList.remove('active'));
}

function showResult(data, sun, moon, rising) {
  document.getElementById('resultSection').classList.add('active');
  // GA ì´ë²¤íŠ¸: ê²°ê³¼ í‘œì‹œ ì™„ë£Œ
  trackEvent('result_shown', 'ìš´ì„¸ê²°ê³¼', 'ì„±ê³µ');
  // GA ì´ë²¤íŠ¸: ìš´ì„¸ ë¶„ì„ ì‹¤í–‰
  trackEvent('analyze', 'ìš´ì„¸', sun + '+' + moon + (rising ? '+' + rising : ''));
  drawGraph(sun, moon, rising);
  buildPathTags(sun, moon, rising);

  const cards = document.getElementById('analysisCards');
  cards.innerHTML = `
    <div class="analysis-card">
      <div class="card-title path"><span class="icon">â¬¡</span> ê´€ê³„ ê²½ë¡œ ë¶„ì„ â€” GraphRAG ì¶”ë¡  ê·¼ê±°</div>
      <div class="card-body">${(data.path_analysis || "").replace(/\n/g, "<br>")}</div>
    </div>
    <div class="analysis-card">
      <div class="card-title deep"><span class="icon">âœ¦</span> ì‹¬ì¸µ ìš´ì„¸ í•´ì„</div>
      <div class="card-body">${(data.deep_reading || "").replace(/\n/g, "<br>")}</div>
    </div>
    <div class="analysis-card">
      <div class="card-title action"><span class="icon">â—ˆ</span> ì§€ê¸ˆ ë‹¹ì¥ í•  ìˆ˜ ìˆëŠ” ê°œìš´ í–‰ë™</div>
      <div class="card-body action-guide-body">${(data.action_guide || "").replace(/\n/g, "<br>")}</div>
    </div>
  `;

  window.scrollTo({ top: 0, behavior: 'smooth' });
}

// ===== ì¹´ì¹´ì˜¤í†¡ / ê³µìœ  =====
function shareKakao() {
  const sun    = document.getElementById('sunSign').value  || '';
  const moon   = document.getElementById('moonSign').value || '';
  const rising = document.getElementById('risingSign').value || '';
  const signText = [sun, moon, rising].filter(Boolean).join(' Â· ');

  const shareTitle = 'ğŸŒŒ ë³„ìë¦¬ ìš´ëª…ì˜ ê·¸ë¬¼';
  const shareText  = '[ ' + signText + ' ] ì¡°í•©ì˜ AI ì‹¬ì¸µ ìš´ì„¸ ê²°ê³¼!\në‚˜ë§Œì˜ ë³„ìë¦¬ ìš´ì„¸ë¥¼ í™•ì¸í•´ë³´ì„¸ìš” âœ¨';
  const shareUrl   = 'https://astro-graphrag-2jty.vercel.app';

  trackEvent('share_kakao', 'ê³µìœ ', signText);

  // â‘  ëª¨ë°”ì¼ ë„¤ì´í‹°ë¸Œ ê³µìœ  (ì¹´ì¹´ì˜¤í†¡ í¬í•¨ ëª¨ë“  ì•± ì„ íƒ ê°€ëŠ¥)
  if (navigator.share) {
    navigator.share({
      title: shareTitle,
      text:  shareText,
      url:   shareUrl
    }).catch(() => {
      // ì·¨ì†Œ ë˜ëŠ” ì‹¤íŒ¨ ì‹œ ë§í¬ ë³µì‚¬ë¡œ ëŒ€ì²´
      copyLink();
    });
  } else {
    // â‘¡ PC ë“± navigator.share ë¯¸ì§€ì› â†’ ë§í¬ ë³µì‚¬
    copyLink();
    showShareToast('ë§í¬ê°€ ë³µì‚¬ëì–´ìš”! ì¹´ì¹´ì˜¤í†¡ì— ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš” ğŸ’¬');
  }
}

function showShareToast(msg) {
  const toast = document.createElement('div');
  toast.textContent = msg;
  toast.style.cssText = `
    position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%);
    background: rgba(107,33,168,0.95); color: #fff; padding: 14px 24px;
    border-radius: 30px; font-size: 0.95rem; z-index: 99999;
    box-shadow: 0 8px 24px rgba(0,0,0,0.4); white-space: nowrap;
    animation: fadeInUp 0.3s ease;
  `;
  document.body.appendChild(toast);
  setTimeout(() => toast.remove(), 3000);
}

// ===== ë§í¬ ë³µì‚¬ =====
function copyLink() {
  const url = window.location.href;
  navigator.clipboard.writeText(url).then(() => {
    const msg = document.getElementById('copyMsg');
    if (msg) {
      msg.style.display = 'block';
      setTimeout(() => { msg.style.display = 'none'; }, 2500);
    }
  }).catch(() => {
    // êµ¬í˜• ë¸Œë¼ìš°ì € ëŒ€ì‘
    const el = document.createElement('textarea');
    el.value = url;
    document.body.appendChild(el);
    el.select();
    document.execCommand('copy');
    document.body.removeChild(el);
    const msg = document.getElementById('copyMsg');
    if (msg) {
      msg.style.display = 'block';
      setTimeout(() => { msg.style.display = 'none'; }, 2500);
    }
  });
  trackEvent('share_link_copy', 'ê³µìœ ', 'ë§í¬ë³µì‚¬');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ğŸŒŒ ìƒë…„ì›”ì¼ ì²œë¬¸ ê³„ì‚° ì—”ì§„ (í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function toJulianDay(year, month, day, hour = 0) {
  const a = Math.floor((14 - month) / 12);
  const y = year + 4800 - a;
  const m = month + 12 * a - 3;
  const jdn = day + Math.floor((153*m+2)/5) + 365*y
    + Math.floor(y/4) - Math.floor(y/100) + Math.floor(y/400) - 32045;
  return jdn - 0.5 + hour / 24;
}

function calcSunLon(jd) {
  const n = jd - 2451545.0;
  const L = (280.460 + 0.9856474*n) % 360;
  const g = ((357.528 + 0.9856003*n) % 360) * Math.PI / 180;
  const lam = L + 1.915*Math.sin(g) + 0.020*Math.sin(2*g);
  return ((lam % 360) + 360) % 360;
}

function calcMoonLon(jd) {
  const T  = (jd - 2451545.0) / 36525;
  const L0 = 218.3164477 + 481267.88123421*T;
  const M  = 134.9633964 + 477198.8675055*T;
  const Ms = 357.5291092 + 35999.0502909*T;
  const F  = 93.2720950  + 483202.0175233*T;
  const D  = 297.8501921 + 445267.1114034*T;
  const r  = x => x * Math.PI / 180;
  const c  = 6.288774*Math.sin(r(M))   + 1.274027*Math.sin(r(2*D-M))
           + 0.658314*Math.sin(r(2*D))  + 0.213618*Math.sin(r(2*M))
           - 0.185116*Math.sin(r(Ms))  - 0.114332*Math.sin(r(2*F))
           + 0.058793*Math.sin(r(2*D-2*M)) + 0.057066*Math.sin(r(2*D-Ms-M))
           + 0.053322*Math.sin(r(2*D+M))   + 0.045758*Math.sin(r(2*D-Ms));
  return ((L0 + c) % 360 + 360) % 360;
}

function calcAscendant(jd, lat, lon) {
  const T    = (jd - 2451545.0) / 36525;
  let gmst   = 280.46061837 + 360.98564736629*(jd-2451545.0) + 0.000387933*T*T;
  gmst = ((gmst % 360) + 360) % 360;
  const lst  = ((gmst + lon) % 360 + 360) % 360;
  const eps  = 23.439291111 - 0.013004167*T;
  const r    = x => x * Math.PI / 180;
  const d    = x => x * 180 / Math.PI;
  const asc  = Math.atan2(
    Math.cos(r(lst)),
    -(Math.sin(r(lst))*Math.cos(r(eps)) + Math.tan(r(lat))*Math.sin(r(eps)))
  );
  return ((d(asc) % 360) + 360) % 360;
}

const SIGN_NAMES = [
  'ì–‘ìë¦¬','í™©ì†Œìë¦¬','ìŒë‘¥ì´ìë¦¬','ê²Œìë¦¬','ì‚¬ììë¦¬','ì²˜ë…€ìë¦¬',
  'ì²œì¹­ìë¦¬','ì „ê°ˆìë¦¬','ì‚¬ìˆ˜ìë¦¬','ì—¼ì†Œìë¦¬','ë¬¼ë³‘ìë¦¬','ë¬¼ê³ ê¸°ìë¦¬'
];
const SIGN_EMOJI = {
  'ì–‘ìë¦¬':'â™ˆ','í™©ì†Œìë¦¬':'â™‰','ìŒë‘¥ì´ìë¦¬':'â™Š','ê²Œìë¦¬':'â™‹',
  'ì‚¬ììë¦¬':'â™Œ','ì²˜ë…€ìë¦¬':'â™','ì²œì¹­ìë¦¬':'â™','ì „ê°ˆìë¦¬':'â™',
  'ì‚¬ìˆ˜ìë¦¬':'â™','ì—¼ì†Œìë¦¬':'â™‘','ë¬¼ë³‘ìë¦¬':'â™’','ë¬¼ê³ ê¸°ìë¦¬':'â™“'
};

function lonToSign(lon) {
  return SIGN_NAMES[Math.floor(((lon%360)+360)%360/30)];
}

function calcChart(year, month, day, hour=12, minute=0, lat=37.5665, lon=126.978) {
  const hourUTC = hour - 9 + minute/60;  // KST â†’ UTC
  const jd = toJulianDay(year, month, day, hourUTC);
  return {
    sun:    lonToSign(calcSunLon(jd)),
    moon:   lonToSign(calcMoonLon(jd)),
    rising: lonToSign(calcAscendant(jd, lat, lon)),
    jd
  };
}

// â”€â”€ íƒ­ ì „í™˜
function switchMode(mode) {
  const tabManual = document.getElementById('tabManual');
  const tabBirth  = document.getElementById('tabBirth');
  const birthForm = document.getElementById('birthForm');
  const signsGrid = document.querySelector('.signs-grid');

  if (mode === 'birth') {
    tabBirth.classList.add('active');
    tabManual.classList.remove('active');
    birthForm.classList.add('active');
    signsGrid.style.display = 'none';
  } else {
    tabManual.classList.add('active');
    tabBirth.classList.remove('active');
    birthForm.classList.remove('active');
    signsGrid.style.display = '';
  }
}

// â”€â”€ ì‹œê°„ í† ê¸€
function toggleTimeFields() {
  const known  = document.getElementById('timeKnown').checked;
  const fields = document.getElementById('timeFields');
  fields.classList.toggle('visible', known);
  onBirthChange();
}

// â”€â”€ ìƒë…„ì›”ì¼ ë³€ê²½ ì‹œ ì‹¤ì‹œê°„ ê³„ì‚°
function onBirthChange() {
  const year   = parseInt(document.getElementById('birthYear').value);
  const month  = parseInt(document.getElementById('birthMonth').value);
  const day    = parseInt(document.getElementById('birthDay').value);
  const known  = document.getElementById('timeKnown').checked;
  const hour   = known ? (parseInt(document.getElementById('birthHour').value)   || 12) : 12;
  const minute = known ? (parseInt(document.getElementById('birthMinute').value) || 0)  : 0;
  const city   = document.getElementById('birthCity').value;

  if (!year || !month || !day || year < 1900 || year > 2025) return;
  if (month < 1 || month > 12 || day < 1 || day > 31) return;

  let lat = 37.5665, lon = 126.978;
  if (city && city !== 'custom') {
    [lat, lon] = city.split(',').map(Number);
  }

  const chart = calcChart(year, month, day, hour, minute, lat, lon);

  // ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
  const preview = document.getElementById('chartPreview');
  const signs   = document.getElementById('chartPreviewSigns');
  preview.classList.add('visible');

  const items = [
    { icon:'â˜€ï¸', label:'íƒœì–‘ê¶', sign: chart.sun },
    { icon:'ğŸŒ™', label:'ë‹¬ê¶',   sign: chart.moon },
  ];
  if (known) items.push({ icon:'â†‘', label:'ìƒìŠ¹ê¶', sign: chart.rising });

  signs.innerHTML = items.map(it => `
    <div class="preview-badge">
      <span class="pb-icon">${it.icon}</span>
      <div>
        <div style="font-weight:700">${SIGN_EMOJI[it.sign] || ''} ${it.sign}</div>
        <div class="pb-label">${it.label}</div>
      </div>
    </div>
  `).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  analyze() í•¨ìˆ˜ í™•ì¥ â€” ìƒë…„ì›”ì¼ ëª¨ë“œ ì§€ì›
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function reset() {
  document.getElementById('resultSection').classList.remove('active');
  document.getElementById('inputSection').style.display = 'block';
  document.getElementById('errorMsg').classList.remove('active');
}

function showError(msg) {
  const el = document.getElementById('errorMsg');
  el.textContent = msg;
  el.classList.add('active');
}
</script>
<!-- ì¹´ì¹´ì˜¤ SDK ë¶ˆí•„ìš” (Web Share API ì‚¬ìš©) -->
</body>
</html>
